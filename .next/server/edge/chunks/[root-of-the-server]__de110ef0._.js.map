{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["// middleware.ts\r\nimport { NextResponse } from \"next/server\"\r\nimport type { NextRequest } from \"next/server\"\r\nimport { getToken } from \"next-auth/jwt\"\r\n\r\nexport async function middleware(req: NextRequest) {\r\n  const { pathname } = req.nextUrl\r\n\r\n  // อนุญาตเสมอ: ไฟล์สาธารณะ และเส้นทาง auth เอง\r\n  if (\r\n    pathname.startsWith(\"/_next\") ||\r\n    pathname.startsWith(\"/api/auth\") ||\r\n    pathname.startsWith(\"/favicon.ico\") ||\r\n    pathname.startsWith(\"/assets\") ||\r\n    pathname === \"/\"\r\n  ) {\r\n    return NextResponse.next()\r\n  }\r\n\r\n  const token = await getToken({\r\n    req,\r\n    secret: process.env.NEXTAUTH_SECRET,\r\n  })\r\n\r\n  // ต้องล็อกอินเพื่อเข้า /dashboard\r\n  if (pathname.startsWith(\"/dashboard\") && !token) {\r\n    return NextResponse.redirect(new URL(\"/login\", req.url))\r\n  }\r\n\r\n  // ต้องเป็น admin เพื่อเข้า /admin\r\n  if (pathname.startsWith(\"/admin\")) {\r\n    if (!token) {\r\n      return NextResponse.redirect(new URL(\"/login\", req.url))\r\n    }\r\n    // ถ้าใช้ TS และยังไม่ได้ augment type ของ JWT ให้ cast ชั่วคราว\r\n    const role = (token as any)?.role\r\n    if (role !== \"admin\") {\r\n      return NextResponse.redirect(new URL(\"/unauthorized\", req.url))\r\n    }\r\n  }\r\n\r\n  return NextResponse.next()\r\n}\r\n\r\nexport const config = {\r\n  // จับเฉพาะเส้นทางที่ต้องป้องกัน\r\n  matcher: [\"/dashboard/:path*\", \"/admin/:path*\"],\r\n}\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;AAAA;AAEA;;;AAEO,eAAe,WAAW,GAAgB;IAC/C,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,8CAA8C;IAC9C,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,gBACpB,SAAS,UAAU,CAAC,mBACpB,SAAS,UAAU,CAAC,cACpB,aAAa,KACb;QACA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,QAAQ,MAAM,CAAA,GAAA,oJAAA,CAAA,WAAQ,AAAD,EAAE;QAC3B;QACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACrC;IAEA,kCAAkC;IAClC,IAAI,SAAS,UAAU,CAAC,iBAAiB,CAAC,OAAO;QAC/C,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;IACxD;IAEA,kCAAkC;IAClC,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,IAAI,CAAC,OAAO;YACV,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;QACxD;QACA,gEAAgE;QAChE,MAAM,OAAQ,OAAe;QAC7B,IAAI,SAAS,SAAS;YACpB,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,IAAI,GAAG;QAC/D;IACF;IAEA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,gCAAgC;IAChC,SAAS;QAAC;QAAqB;KAAgB;AACjD"}}]
}